<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by cdoc on Wed Jan 26 05:45:09 2005 -->
<title>
file libsrc/libgODBC/ODBCDescribeCols.c
</title>
</head>
<body>
<a name="_top_"></a><pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCConnect.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCError.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
File libsrc/libgODBC/ODBCDescribeCols.c
</h1>
<hr>
<!End-Header>  This routine is used to obtain information about the columns that are
   returned by an arbitrary SQL query. The information is placed
   in the ODBC_ColumnResult strcuture, which is defined as:
   <pre>
   typedef struct
   {
       SQLCHAR         columnName[ODBC_STRLEN];
       SQLSMALLINT     nameLength;
       SQLSMALLINT     dataType;
       SQLUINTEGER     columnSize;
       SQLSMALLINT     decimalDigits;
       SQLSMALLINT     nullable;
       SQLPOINTER      value;
       union {
           char                 sql_String[ODBC_STRLEN];
           SQLDOUBLE            sql_Double;
           SQLINTEGER           sql_Long;
           SQLSMALLINT          sql_Int;
           SQL_TIMESTAMP_STRUCT sql_DateTime;
       } bindTarget;
       SQLINTEGER      indicator;
       SQLINTEGER      numRows;
   } ODBC_ColumnResult;
  </pre>
  <p>
  This routine is used together with ODBCGetResultCols to retrieve the
  results of an arbitrary SQL query, where the names of columns and the
  data types of columns are not known beforehand. The following code
  shows the routine ODBCGeneralQuery, which uses ODBC_ColumnResult and
  ODBCGetResultCols to retrieve the data from an arbitrary query.
 
  <pre>
   int
   ODBCGeneralQuery(SQLHDBC hdbc, char *query, ODBC_Result *result)
   {
       int i;
       SQLHSTMT hstmt;
       SQLRETURN ret;
   
       result->column = NULL;
   
       ret = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);
       if(ret != SQL_SUCCESS && ret != SQL_SUCCESS_WITH_INFO)
       {
           ODBCSetErrorMsg("ODBCGeneralQuery", SQL_HANDLE_DBC, hdbc);
           return -1;
       }
  
       /* Execute the query */
       ret = SQLExecDirect(hstmt, query, SQL_NTS);
       if(ret != SQL_SUCCESS && ret != SQL_SUCCESS_WITH_INFO)
       {
           ODBCSetErrorMsg("ODBCGeneralQuery", SQL_HANDLE_STMT, hstmt);
           if(SQLFreeHandle(SQL_HANDLE_STMT, hstmt) != SQL_SUCCESS) {
             logErrorMsg(LOG_WARNING,"ODBCGeneralQuery:SQLFreeHandle failed.");
           }
           return -1;
       }
   
       /* Get the column descriptions of the rows that are returned. */
       if(ODBCDescribeCols(hstmt, &result->numColumns, &result->column) < 0)
       {
           return -1;
       }
  
       /* Using the column data types, copy the results into the appropriate
        * variables.
        */
       ret = ODBCGetResultCols(hstmt, result->numColumns, result->column);
   
       /* Check for consistent results */
       if(ret == SQL_SUCCESS || ret == SQL_SUCCESS_WITH_INFO)
       {
           ret = 0;
           if(result->numColumns > 0) {
               result->numRows = result->column[0].numRows;
           }
           for(i = 1; i < result->numColumns &&
               result->column[i].numRows == result->column[0].numRows; i++);
           if(i < result->numColumns) {
               ODBCSetErrorMsg("ODBCGeneralQuery: column lengths vary.",0,0);
               ret = -1;
           }
       }
   
       if(SQLFreeHandle(SQL_HANDLE_STMT, hstmt) != SQL_SUCCESS) {
            logErrorMsg(LOG_WARNING,"ODBCGeneralQuery: SQLFreeHandle failed.");
       }
   
       return ret;
   }
  </pre>
<hr>
<h2>
Public Functions
</h2>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCDescribeCols"><b>ODBCDescribeCols</b></a>
<pre>
 int ODBCDescribeCols(SQLHSTMT hstmt,
                      int *numColumns,
                      <a href="include_libgODBC.h.html#ODBC_ColumnResult">ODBC_ColumnResult</a> **columns)
</pre>
<dl>
<dd> Get information about the columns returned from a query.   Fill an ODBC_Column structure for each column.
  Returns zero for success. Returns -1 for an error flag. Retrieve the
  error number and error message with ODBCErrno() and ODBCErrMsg().

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hstmt - A statement handle obtained from SQLAllocHandle.

<dd> numColumns - The number of columns in the result.

<dd> columns - An array of numColumns ODBC_ColumnResult structures.

</dl></dd>
<p>
<dd><dl>
<dt> <b>See Also:</b>
<dd> <a href="libsrc_libgODBC_ODBCGetResultCols.c.html#ODBCGetResultCols">ODBCGetResultCols</a>
<dd> <a href="libsrc_libgODBC_ODBCGeneralQuery.c.html#ODBCGeneralQuery">ODBCGeneralQuery</a>
</dl></dd>
</dl>
<!Begin-Footer><hr>
<pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCConnect.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCError.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
