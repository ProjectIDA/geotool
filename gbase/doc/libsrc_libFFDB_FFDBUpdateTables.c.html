<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by cdoc on Wed Jan 26 05:45:09 2005 -->
<title>
file libsrc/libFFDB/FFDBUpdateTables.c
</title>
</head>
<body>
<a name="_top_"></a><pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libFFDB.html">This Directory</a>  <a href="libsrc_libFFDB_FFDBStatic.c.html#_top_">Previous</a>  <a href="libsrc_libFK.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
File libsrc/libFFDB/FFDBUpdateTables.c
</h1>
<hr>
<!End-Header> These routines update specific members (columns) of database tables.
  Six routines, FFDBUpdateTable(), FFDBUpdateTables(),
  FFDBUpdateTableWhere(), FFDBUpdateTablesWhere(), FFDBUpdateWhere(), and
  FFDBUpdate() update one or more table records. FFDBDeleteTable()
  deletes a record from the database. FFDBGetWhereMembers returns ordered
  members indices for a where clause.
  <p>
  The four routines FFDBUpdateTable(), FFDBUpdateTables(),
  FFDBUpdateTableWhere(), and FFDBUpdateTablesWhere() form the where clause
  of the update command from the member values of unchanged table records.
  Some routines allow the specification of which members to use in the where
  clause and other routines automatically use all members, except those of
  type CSS_LDDATE. Columns of type CSS_LDDATE are automatically updated using
  timeLoadDate().  Routines that use all table members in the where clause
  use FFDBGetWhereMembers() to order the members. Id members (arid,orid, etc)
  are place first followed by all other integer members, all string members
  and then all float and double members. An SQL between operator is used
  to specify a small range for the float and double members. For float
  members the between interval is (f +/- 1.e-06*fabs(f)). For double
  members the interval is (d +/- 1.e-10*fabs(d)).
  <p>
  The routine FFDBUpdateWhere() updates the indicated table members for all
  of the records returned by an input select statement. The routine FFDBUpdate
  updates a record without querying the database. The table record must have
  been created by FFDBQueryTable() or FFDBQueryTableResults(). FFDPUpdate
  uses information from the CssTable object to directly rewrite the
  record.
  
  The following example shows the use of FFDBUpdateTableWhere to update the
  depth member of the origin table. The orid and evid are included in the
  where clause.
  </p>
  <pre>
  #include "libFFDB.h"
  
  int
  main(int argc, char **argv)
  {
      int ret, autoCommit=1;
      int where[2], memberIndices[1];
      char *param_root = "flat/param"
      char *seg_root = "flat/seg"
      char *directory_structure = "%Y/%m/%d";
      double directory_duration = 24*60*60; /* one day */
      FFDatabase ffdb;
      CssOrigin old, new;
  
      /* Open the Flat-File database
       */
      if((ffdb = FFDBOpen(param_root, seg_root, directory_structure,
          directory_duration)) == NULL)
      {
          logErrorMsg(LOG_WARNING, FFDBErrMsg());
          exit(1);
      }
  
      /* Create a CssOrigin structure with null values
       */
      old = (CssOrigin)new_CssTable("origin");
  
      /* Set the orid and evid values.
       */
      old->orid = 296229;
      old->evid = 296229;
  
      /* Create another CssOrigin structure.
       */
      new = (CssOrigin)new_CssTable("origin");
  
      /* Set the depth value.
       */
      new->depth = 50.;
  
      /* Set the "where" indices.
       */
      where[0] = CssTable_memberIndex(old, "orid");
      where[1] = CssTable_memberIndex(old, "evid");
  
      /* Set the indices of the members that will be updated.
       */
      memberIndices[0] = CssTable_memberIndex(old, "depth");
  
      /* Update the table. The effect of this call is the same as the SQL
       * command "update sel3.origin set depth=50.,lddate=timeLoadDate()
       * where orid=296229 and evid=296229".
       */
      ret = FFDBUpdateTableWhere(ffdb, "author1.origin", 1, memberIndices, 2,
                          where, (CssTable)old, (CssTable)new);
  
      if(ret !=  0) {
          logErrorMsg(LOG_WARNING, FFDBErrMsg());
      }
  
      FFDBClose(ffdb);
  
      /* Free tables allocated.
       */
      GObject_free((GObject)old);
      GObject_free((GObject)new);
  }
  </pre>
  A second example below contains some lines that demonstrate the use of
  FFDBUpdate. Notice that it requires neither "where" indices nor
  memberIndices. It uses information from the CssTable instance to directly
  rewrite the table record. FFDBUpdateTable is convenient when you are
  updating a table object that was obtained from the database.
  </p>
  <pre>
 
      FFDatabase ffdb;
      char query[1000];
      CssOrigin o;
      Vector v;
      ...
 
      v = new_Vector();
 
      strcpy(query, "select * from author1.origin where orid=296229");
 
      ret = FFDBQueryTable(ffdb, query, "origin", v);
 
      if(ret !=  0) {
          logErrorMsg(LOG_WARNING, FFDBErrMsg());
          exit(1);
      }
      if(v->elementCount == 0)
      {
          logErrorMsg(LOG_WARNING, "No records returned.");
          exit(0);
      }
 
      o = (CssOrigin)v->elementData[0];
 
     /* change some members
      */
      o.lat = 46.7;
      o.depth = 10.3;
      o.evid = 44363;
 
      /* Update the table.
       */
      FFDBUpdate(ffdb, o);
 
      FFDBClose(ffdb);
 
      GObject_free((GObject)v);
  </pre>
<hr>
<h2>
Public Function Index
</h2>
<dl>
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBDeleteTable"><b>FFDBDeleteTable</b></a> (FFDatabase, CssTable)
<dd> Delete a database table record.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBGetWhereMembers"><b>FFDBGetWhereMembers</b></a> (CssTable, int *)
<dd> Return the members indices of a CssTable ordered for a where clause.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBUpdate"><b>FFDBUpdate</b></a> (FFDatabase, CssTable)
<dd> Update a table.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBUpdateTable"><b>FFDBUpdateTable</b></a> (FFDatabase, const char *, CssTable, CssTable)
<dd> Update one database record.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBUpdateTables"><b>FFDBUpdateTables</b></a> (FFDatabase, const char *, int, CssTable *, CssTable *)
<dd> Update num database records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBUpdateTablesWhere"><b>FFDBUpdateTablesWhere</b></a> (FFDatabase, const char *, int, int *, int, int *, int, CssTable *, CssTable *)
<dd> Update num database records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBUpdateTableWhere"><b>FFDBUpdateTableWhere</b></a> (FFDatabase, const char *, int, int *, int, int *, CssTable, CssTable)
<dd> Update one database record.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#FFDBUpdateWhere"><b>FFDBUpdateWhere</b></a> (FFDatabase, int, int *, CssTable, const char *)
<dd> Update database records.
</dl>
<h2>
Public Functions
</h2>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBDeleteTable"><b>FFDBDeleteTable</b></a>
<pre>
 int FFDBDeleteTable(FFDatabase ffdb,
                     CssTable t)
</pre>
<dl>
<dd>  Delete a database table record.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> table - The CssTable object.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the  error message with  FFDBErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBGetWhereMembers"><b>FFDBGetWhereMembers</b></a>
<pre>
 int FFDBGetWhereMembers(CssTable css,
                         int *where)
</pre>
<dl>
<dd>   Return the members indices of a CssTable ordered for a where clause.
   Id members (arid,orid, etc) are place first followed by all other integer
   members, all string members and then all float and double members.
   Members of type CSS_LDDATE are not included.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> css - A CssTable object.

<dd> where - The ordered member indices.

<dt> <b>Returns:</b>
<dd> the number of indices returned in where[].

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBUpdate"><b>FFDBUpdate</b></a>
<pre>
 int FFDBUpdate(FFDatabase ffdb,
                CssTable t)
</pre>
<dl>
<dd>  Update a table.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> t - The CssTable object.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the  error message with  FFDBErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBUpdateTable"><b>FFDBUpdateTable</b></a>
<pre>
 int FFDBUpdateTable(FFDatabase ffdb,
                     const char *tableName,
                     CssTable old_table,
                     CssTable new_table)
</pre>
<dl>
<dd>  Update one database record. Update each member (column) of old_table
  that differs from the corresponding member in new_table. Columns of type
  CSS_LDDATE are automatically updated using timeLoadDate(). All of the
  members of old_table (except CSS_LDDATE members) are used in the where clause.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> tableName - The database table name, with an author prefix if needed.

<dd> old_table - The original CssTable object whose elements will be used  in the where clause.

<dd> new_table - The CssTable object with new values.

<dt> <b>Returns:</b>
<dd> the number of records updated. Returns -1 for failure.  Retrieve  the error message with FFDBErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBUpdateTables"><b>FFDBUpdateTables</b></a>
<pre>
 int FFDBUpdateTables(FFDatabase ffdb,
                      const char *tableName,
                      int num,
                      CssTable *old_tables,
                      CssTable *new_tables)
</pre>
<dl>
<dd>  Update num database records. Update each member (column) of each record in
  new_tables that differs from the corresponding member and record in
  old_tables. Columns of type CSS_LDDATE are automatically updated using
  timeLoadDate(). All of the members of the old_tables records
  (except CSS_LDDATE members) are used in the where clause.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> tableName - The database table name, with an author prefix if needed.

<dd> num - The number of records to update.

<dd> old_tables - The original CssTable objects whose elements will be used  in the where clause.

<dd> new_tables - The CssTable objects with new values.

<dt> <b>Returns:</b>
<dd> the number of records updated. Returns -1 for failure.  Retrieve  the error message with FFDBErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBUpdateTablesWhere"><b>FFDBUpdateTablesWhere</b></a>
<pre>
 int FFDBUpdateTablesWhere(FFDatabase ffdb,
                           const char *tableName,
                           int numMembers,
                           int *memberIndices,
                           int numWhere,
                           int *whereIndices,
                           int num,
                           CssTable *old_tables,
                           CssTable *new_tables)
</pre>
<dl>
<dd>  Update num database records. The members to update are specified by
  the memberIndices array. (Columns of type CSS_LDDATE are automatically
  updated using timeLoadDate().) The members to use in the where
  clause are specified by the whereIndices array. The updated values are
  taken from the new_tables objects and the where values are taken from the
  old_tables objects.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> tableName - The database table name, with an author prefix if needed.

<dd> numMembers - The number of members of each record to update.

<dd> memberIndices - The indices of the members in the CssTable structure.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the where members in the CssTable  structure.

<dd> num - The number of records to update.

<dd> old_tables - The original CssTable objects whose members will be used  in the where clause.

<dd> new_tables - The CssTable objects with new values.

<dt> <b>Returns:</b>
<dd> the number of records updated. Returns -1 for failure.  Retrieve  the error message with FFDBErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBUpdateTableWhere"><b>FFDBUpdateTableWhere</b></a>
<pre>
 int FFDBUpdateTableWhere(FFDatabase ffdb,
                          const char *tableName,
                          int numMembers,
                          int *memberIndices,
                          int numWhere,
                          int *whereIndices,
                          CssTable old_table,
                          CssTable new_table)
</pre>
<dl>
<dd>  Update one database record. The members to update are specified by
  the memberIndices array. (Columns of type CSS_LDDATE are automatically
  updated using timeLoadDate().) The members to use in the where
  clause are specified by the whereIndices array. The updated values are
  taken from the new_table object and the where values are taken from the
  old_table object.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> tableName - The database table name, with an author prefix if needed.

<dd> numMembers - The number of members of the new_table object to update.

<dd> memberIndices - The indices of the members in the CssTable structure.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the where members in the CssTable  structure.

<dd> old_table - The original CssTable object whose members will be used  in the where clause.

<dd> new_table - The CssTable object with new values.

<dt> <b>Returns:</b>
<dd> the number of records updated. Returns -1 for failure.  Retrieve  the error message with FFDBErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="FFDBUpdateWhere"><b>FFDBUpdateWhere</b></a>
<pre>
 int FFDBUpdateWhere(FFDatabase ffdb,
                     int numMembers,
                     int *memberIndices,
                     CssTable t,
                     const char *select_clause)
</pre>
<dl>
<dd>  Update database records. The members to update are specified by
  the memberIndices array. (Columns of type CSS_LDDATE are automatically
  updated using timeLoadDate().) All records that are retrieved with the
  input select clause are updated. The updated values are taken from the
  input CssTable object.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> ffdb - An FFDatabase pointer from FFDBOpen().

<dd> numMembers - The number of members of each record to update.

<dd> memberIndices - The indices of the members in the CssTable structure.

<dd> t - The CssTable objects with new values.

<dd> select_clause - A selection clause for the table records to update.

<dt> <b>Returns:</b>
<dd> the number of records updated. Returns -1 for failure.  Retrieve  the error message with FFDBErrMsg().

</dl></dd>
</dl>
<!Begin-Footer><hr>
<pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libFFDB.html">This Directory</a>  <a href="libsrc_libFFDB_FFDBStatic.c.html#_top_">Previous</a>  <a href="libsrc_libFK.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
