<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by cdoc on Wed Jan 26 05:45:09 2005 -->
<title>
file libsrc/libgODBC/ODBCGetSchema.c
</title>
</head>
<body>
<a name="_top_"></a><pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCGetResultCols.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCGetStruct.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
File libsrc/libgODBC/ODBCGetSchema.c
</h1>
<hr>
<!End-Header> Get information about available tables. ODBCGetSchema() fills the
  ODBC_Table structure with information about all available tables for
  a given ODBC connection. The ODBC_Table structure is defined as:
  <pre>
   typedef struct
   {
           SQLCHAR         catalog[ODBC_STRLEN];
           SQLCHAR         schema[ODBC_STRLEN];
           SQLCHAR         tableName[ODBC_STRLEN];
           SQLCHAR         columnName[ODBC_STRLEN];
           SQLSMALLINT     dataType;
           SQLCHAR         typeName[ODBC_STRLEN];
           SQLINTEGER      columnSize;
           SQLINTEGER      bufferLength;
           SQLSMALLINT     decimalDigits;
           SQLSMALLINT     numPrecRadix;
           SQLSMALLINT     nullable;
           SQLCHAR         remarks[ODBC_REMLEN];
           SQLCHAR         columnDefault[ODBC_STRLEN];
           SQLSMALLINT     sqlDataType;
           SQLSMALLINT     datetimeSubtypeCode;
           SQLINTEGER      charOctetLength;
           SQLINTEGER      ordinalPosition;
           SQLCHAR         isNullable[ODBC_STRLEN];
   } ODBC_Column;
   
   typedef struct
   {
           SQLCHAR         catalog[ODBC_STRLEN];
           SQLCHAR         schema[ODBC_STRLEN];
           SQLCHAR         tableName[ODBC_STRLEN];
           SQLCHAR         tableType[ODBC_STRLEN];
           SQLCHAR         remarks[ODBC_REMLEN];
   
           int             numColumns;
           ODBC_Column     *columns;
   } ODBC_Table;
  </pre>
 
  <p>
  The following code illustrates the use of ODBCGetSchema.
  <pre>
  #include "libgODBC.h"
  
  int
  main(int argc,char **argv)
  {
      int i, j, numTables, autoCommit=1;
      char *dataSource="ORACLE", *user="sel3", *passwd="sel3";
      ODBC_Table *tables;
      SQLRETURN ret;
      SQLHDBC hdbc;
  
      /* Connect to the data source
       */
      if((hdbc = ODBCConnect(dataSource, user, passwd, autoCommit)) == NULL) {
          logErrorMsg(LOG_WARNING, ODBCErrMsg());
          exit(1);
      }
  
      ret = ODBCGetSchema(hdbc, &numTables, &tables);
      if(ret != 0) {
 	   char msg[100];
          snprintf(msg, 100, "ODBCGetSchema failed: %s\n", ODBCErrMsg());
 	   logErrorMsg(LOG_WARNING, msg);
          exit(1);
      }
  
      for(i = 0; i < numTables; i++)
      {
          printf("catalog:%s schema:%s tableName:%s tableType:%s remarks:%s\n",
             tables[i].catalog, tables[i].schema,
             tables[i].tableName, tables[i].tableType,
             tables[i].remarks);
  
          printf("number of columns: %d\n", tables[i].numColumns);
  
          if(tables[i].numColumns > 0)
          {
              printf(
  "     name      type   size buflen decimal radix nullable   remark  default\n");
              for(j = 0; j < tables[i].numColumns; j++) {
                 printf("%10s %10s %3d   %3d    %3d     %3d      %1d   %s   %s\n",
                     tables[i].columns[j].columnName,
                     tables[i].columns[j].typeName,
                     (int)tables[i].columns[j].columnSize,
                     (int)tables[i].columns[j].bufferLength,
                     tables[i].columns[j].decimalDigits,
                     tables[i].columns[j].numPrecRadix,
                     tables[i].columns[j].nullable,
                     tables[i].columns[j].remarks,
                     tables[i].columns[j].columnDefault);
              }
          }
          printf("\n");
      }
  
      ODBCDisconnect(hdbc);
  
      for(i = 0; i < numTables; i++) free(tables[i].columns);
      free(tables);
  }
  </pre>
<hr>
<h2>
Public Functions
</h2>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCGetSchema"><b>ODBCGetSchema</b></a>
<pre>
 int ODBCGetSchema(SQLHDBC hdbc,
                   unsigned char *schemaName,
                   int *numTables,
                   <a href="include_libgODBC.h.html#ODBC_Table">ODBC_Table</a> **tables)
</pre>
<dl>
<dd>  Get information about tables. This routine returns a list of tables found
  for the input connection handle. A structure of schema information is
  returned for each table.
 		     schemas will be returned. 

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - A connection handle obtained from ODBCConnect().

<dd> schemaName - The name of the schema. If NULL, tables from all 

<dd> numTables - The number of tables available.

<dd> tables - An array of numTables ODBC_Table structures.

<dt> <b>Returns:</b>
<dd> 0 for success, -1 for failure. Retrieve the error number and  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<!Begin-Footer><hr>
<pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCGetResultCols.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCGetStruct.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
