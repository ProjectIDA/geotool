<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by cdoc on Wed Jan 26 05:45:09 2005 -->
<title>
file libsrc/libgODBC/ODBCQueryTable.c
</title>
</head>
<body>
<a name="_top_"></a><pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCInsertTables.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCRequestIds.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
File libsrc/libgODBC/ODBCQueryTable.c
</h1>
<hr>
<!End-Header> Routines for submitting queries that return full table rows. The query
  results are returned in CssTable structures.
  <p>
  ODBCQueryTable() submits the query and returns all rows in one step.
  </p>
  <p>
  ODBCQueryTableInit(), ODBCQueryTableResults() and ODBCQueryTableClose()
  can be used to submit a query and then fetch as many rows as desired.
  Rows not fetched are discarded. For example:
  </p>
  <pre>
    #include "libgODBC.h"
 
    int i, num, ret, autoCommit=1;
    char *dataSource="ORACLE", *user="idcx", *passwd="idcx";
    char query[500];
    SQLHDBC hdbc;
    ODBC_QueryTableStruct *qs;
    Vector records;
 
 
    /* Connect to the data source */
    if((hdbc = ODBCConnect(dataSource, user, passwd, autoCommit)) == NULL) {
        logErrorMsg(LOG_WARNING, ODBCErrMsg());
        exit(1);
    }
 
    strcpy(query,
        "select * from wfdisc where time > 1067530898 and sta like 'FIA0'");
  
    /* Execute the query */
    if(ODBCQueryTableInit(hdbc, query, "wfdisc", &qs)) {
        logErrorMsg(LOG_WARNING, ODBCErrMsg());
        exit(1);
    }
 
    /* Allocate a vector to hold the CssTable objects */
    records = new_Vector();
 
    /* Fetch the results in 1000 row chunks */
    while((ret = ODBCQueryTableResults(qs, 1000, &num, records)) > 0)
    {
        ...
        /* Check the total number of rows received. Rows are appended. */
        if(records->elementCount > 20000) {
            break;  /* If too many, stop */
        }
    }
    ODBCQueryTableClose(qs);  /* Discards any rows not received */
 
    if(ret < 0) {
        logErrorMsg(LOG_WARNING, ODBCErrMsg());
    }
    
    /* Process the records */
    for(i = 0; i < records->elementCount; i++)
    {
        CssWfdisc w = (CssWfdisc)records->elementData[i];
        if(w->calper < .1) {
        ...
    }
 
    GObject_free((GObject)records);
    ODBCDisconnect(hdbc);
  </pre>
<hr>
<h2>
Public Function Index
</h2>
<dl>
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCQueryTable"><b>ODBCQueryTable</b></a> (SQLHDBC, const char *, const char *, Vector)
<dd> Fetch all table rows for a query.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCQueryTableClose"><b>ODBCQueryTableClose</b></a> (ODBC_QueryTableStruct *)
<dd> Terminate a query that was initiated by ODBCQueryTableInit().
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCQueryTableInit"><b>ODBCQueryTableInit</b></a> (SQLHDBC, const char *, const char *, ODBC_QueryTableStruct **)
<dd> Submit a query that will return full table rows.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCQueryTableResults"><b>ODBCQueryTableResults</b></a> (ODBC_QueryTableStruct *, int, int *, Vector)
<dd> Fetch the table rows that result from a query submitted to
   ODBCQueryTableInit().
</dl>
<h2>
Public Functions
</h2>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCQueryTable"><b>ODBCQueryTable</b></a>
<pre>
 int ODBCQueryTable(SQLHDBC hdbc,
                    const char *query,
                    const char *cssTableName,
                    Vector table)
</pre>
<dl>
<dd>   Fetch all table rows for a query. All the table rows are returned for
   the input query as CssTable objects.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - A connection handle obtained from ODBCConnect().

<dd> query - An SQL query that should return full table rows.

<dd> cssTableName - The CSS3.0 table name of the expected rows (input).

<dd> table - A Vector array to receive the CssTable objects.

<dt> <b>Returns:</b>
<dd> 0 for success, -1 for failure.  Retrieve the error number and  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
<p>
<dd><dl>
<dt> <b>See Also:</b>
<dd> <a href="libsrc_libgODBC_ODBCConnect.c.html#ODBCConnect">ODBCConnect</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrno">ODBCErrno</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrMsg">ODBCErrMsg</a>
<dd> <a href="libsrc_libgobject_Vector.c.html#new_Vector">new_Vector</a>
</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCQueryTableClose"><b>ODBCQueryTableClose</b></a>
<pre>
 int ODBCQueryTableClose(<a href="include_libgODBC.h.html#ODBC_QueryTableStruct">ODBC_QueryTableStruct</a> *qs)
</pre>
<dl>
<dd>   Terminate a query that was initiated by ODBCQueryTableInit().
   This routine can be called anytime after ODBCQueryTableInit(). All rows
   that have not been fetched with ODBCQueryTableResults() will be
   discarded. This routine should be called to free the resources allocated
   by ODBCQueryTableInit.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> qs - A ODBC_QueryTableStruct pointer that was obtained from  ODBCQueryTableInit().

<dt> <b>Returns:</b>
<dd> 0 for success, -1 for failure.  Retrieve the error number and  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
<p>
<dd><dl>
<dt> <b>See Also:</b>
<dd> <a href="libsrc_libgODBC_ODBCQueryTable.c.html#ODBCQueryTableInit">ODBCQueryTableInit</a>
<dd> <a href="libsrc_libgODBC_ODBCQueryTable.c.html#ODBCQueryTableResults">ODBCQueryTableResults</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrno">ODBCErrno</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrMsg">ODBCErrMsg</a>
</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCQueryTableInit"><b>ODBCQueryTableInit</b></a>
<pre>
 int ODBCQueryTableInit(SQLHDBC hdbc,
                        const char *query,
                        const char *cssTableName,
                        <a href="include_libgODBC.h.html#ODBC_QueryTableStruct">ODBC_QueryTableStruct</a> **qs)
</pre>
<dl>
<dd>   Submit a query that will return full table rows. This routine is used
   together with ODBCQueryTableResults() and ODBCQueryTableClose() to
   submit a query and fetch the results in chunks. An ODBC_QueryTableStruct
   pointer is returned that can be used to retrieve the desired number of
   table rows with ODBCQueryTableResults().

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - A connection handle obtained from ODBCConnect().

<dd> query - An SQL query that should return full table rows.

<dd> cssTableName - The CSS3.0 table name of the expected rows (input).

<dd> qs - A ODBC_QueryTableStruct pointer that is returned.

<dt> <b>Returns:</b>
<dd> 0 for success, -1 for failure.  Retrieve the error number and  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
<p>
<dd><dl>
<dt> <b>See Also:</b>
<dd> <a href="libsrc_libgODBC_ODBCConnect.c.html#ODBCConnect">ODBCConnect</a>
<dd> <a href="libsrc_libgODBC_ODBCQueryTable.c.html#ODBCQueryTableResults">ODBCQueryTableResults</a>
<dd> <a href="libsrc_libgODBC_ODBCQueryTable.c.html#ODBCQueryTableClose">ODBCQueryTableClose</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrno">ODBCErrno</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrMsg">ODBCErrMsg</a>
</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCQueryTableResults"><b>ODBCQueryTableResults</b></a>
<pre>
 int ODBCQueryTableResults(<a href="include_libgODBC.h.html#ODBC_QueryTableStruct">ODBC_QueryTableStruct</a> *qs,
                           int numToFetch,
                           int *numFetched,
                           Vector table)
</pre>
<dl>
<dd>   Fetch the table rows that result from a query submitted to
   ODBCQueryTableInit(). The rows are returned as CssTable objects in the
   Vector table. The CssTable objects are <b>appended</b> to the Vector.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> qs - A ODBC_QueryTableStruct pointer that was obtained from  ODBCQueryTableInit().

<dd> numToFetch - The maximum number of table rows this routine will return.

<dd> numFetched - The actual number of table rows returned.

<dd> table - A vector to hold the CssTable objects. Objects are appended.

<dt> <b>Returns:</b>
<dd> the number of rows fetched or -1 for failure.  Retrieve the error  number and error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
<p>
<dd><dl>
<dt> <b>See Also:</b>
<dd> <a href="libsrc_libgODBC_ODBCQueryTable.c.html#ODBCQueryTableInit">ODBCQueryTableInit</a>
<dd> <a href="libsrc_libgODBC_ODBCQueryTable.c.html#ODBCQueryTableClose">ODBCQueryTableClose</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrno">ODBCErrno</a>
<dd> <a href="libsrc_libgODBC_ODBCError.c.html#ODBCErrMsg">ODBCErrMsg</a>
</dl></dd>
</dl>
<!Begin-Footer><hr>
<pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCInsertTables.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCRequestIds.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
