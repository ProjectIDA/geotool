<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by cdoc on Wed Jan 26 05:45:09 2005 -->
<title>
file libsrc/libgODBC/ODBCUpdateTables.c
</title>
</head>
<body>
<a name="_top_"></a><pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCRequestIds.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCUtil.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
File libsrc/libgODBC/ODBCUpdateTables.c
</h1>
<hr>
<!End-Header>  These routines update specific members (columns) of database tables.
   Four routines, ODBCUpdateTable(), ODBCUpdateTables(),
   ODBCUpdateTableWhere() and ODBCUpdateTablesWhere() update one or more
   table records. Two other routines count records, ODBCCountTable() and
   ODBCCountTables(). And there are four routines that delete records from
   the database, ODBCDeleteTable(), ODBCDeleteTables(), ODBCDeleteTableWhere(),
   and ODBCDeleteTablesWhere().
   <p>
   All data is transfered to the ODBC server by binding to memory locations.
   This includes data values inserted into the table and also data values
   used in the "where clause". (Queries are formed using the '?' character
   to denote bound parameters.) Columns of type CSS_LDDATE are automatically
   updated using name=CURRENT_TIMESTAMP.
   <p>
   SQL "where clauses" are constructed using members of the original records.
   Some routines allow the specification of which members to use in the where
   clause and other routines automatically use all members, except those of
   type CSS_LDDATE. Routines that use all table members in the where clause
   use ODBCGetWhereMembers() to order the members. Id members (arid,orid, etc)
   are place first followed by all other integer members, all string members
   and then all float and double members. An SQL between operator is used
   to specify a small range for the float and double members. For float
   members the between interval is (f +/- 1.e-06*fabs(f)). For double
   members the interval is (d +/- 1.e-10*fabs(d)).
  <p>
  The following example shows the use of ODBCUpdateTableWhere to update the
  depth member of the origin table. The orid and evid are included in the
  where clause.
  </p>
  <pre>
  #include "libgODBC.h"
  
  int
  main(int argc, char **argv)
  {
      int ret, autoCommit=1;
      int where[2], memberIndices[1];
      char *dataSource="ORACLE", *user="sel3", *passwd="sel3";
      SQLHDBC hdbc;
      CssOrigin old, new;
  
      /* Connect to the data source
       */
      if((hdbc = ODBCConnect(dataSource, user, passwd, autoCommit)) == NULL) {
          logErrorMsg(LOG_WARNING, ODBCErrMsg());
          exit(1);
      }
  
      /* Create a CssOrigin structure with null values
       */
      old = (CssOrigin)new_CssTable("origin");
  
      /* Set the orid and evid values.
       */
      old->orid = 296229;
      old->evid = 296229;
  
      /* Create another CssOrigin structure.
       */
      new = (CssOrigin)new_CssTable("origin");
  
      /* Set the depth value.
       */
      new->depth = 50.;
  
      /* Set the "where" indices.
       */
      where[0] = CssTable_memberIndex(old, "orid");
      where[1] = CssTable_memberIndex(old, "evid");
  
      /* Set the indices of the members that will be updated.
       */
      memberIndices[0] = CssTable_memberIndex(old, "depth");
  
      /* Update the table. The effect of this call is the same as the SQL
       * command "update sel3.origin set depth=50.,lddate=CURRENT_TIMESTAMP
       * where orid=296229 and evid=296229".
       */
      ret = ODBCUpdateTableWhere(hdbc, "sel3.origin", 1, memberIndices, 2,
                          where, (CssTable)old, (CssTable)new);
  
      if(ret !=  0) {
          logErrorMsg(LOG_WARNING, ODBCErrMsg());
      }
  
      ODBCDisconnect(hdbc);
  
      /* Free tables allocated.
       */
      GObject_free((GObject)old);
      GObject_free((GObject)new);
  }
  </pre>
  A second example below contains some lines that demonstrate the use of
  ODBCUpdateTable. Notice that it requires neither "where" indices nor
  memberIndices. It will use all members (except CssDate members) in the
  where clause and it will update all members of table2 that are different
  from table1. ODBCUpdateTable is convenient when you are updating a table
  row that was recently obtained from the database.
  </p>
  <pre>
 
      SQLHDBC hdnc;
      char query[1000];
      CssOrigin o1, o2;
      Vector v;
      ...
 
      v = new_Vector();
 
      strcpy(query, "select * from sel3.origin where orid=296229");
 
      ret = ODBCQueryTable(hdbc, query, "origin", v);
 
      if(ret !=  0) {
          logErrorMsg(LOG_WARNING, ODBCErrMsg());
          exit(1);
      }
      if(v->elementCount == 0)
      {
          logErrorMsg(LOG_WARNING, "No records returned.");
          exit(0);
      }
 
      o1 = (CssOrigin)v->elementData[0];
 
      /* make a copy
       */
      o2 = (CssOrigin)GObject_clone((GObject)o1);
 
     /* change some members
      */
      o2.lat = 46.7;
      o2.depth = 10.3;
      o2.evid = 44363;
 
      /* update the table. All members of o1 will be used in the where clause.
       * All members of o2 that differ from o1 (lat, depth and evid) will be
       * updated.
       */
      ODBCUpdateTable(hdbc, "sel3.origin", o1, o2);
 
      ODBCDisconnect(hdbc);
 
      GObject_free((GObject)v);
      GObject_free((GObject)o2);
  </pre>
<hr>
<h2>
Public Function Index
</h2>
<dl>
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCCountTable"><b>ODBCCountTable</b></a> (SQLHDBC, const char *, int, int *, CssTable, int *)
<dd> Count database records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCCountTables"><b>ODBCCountTables</b></a> (SQLHDBC, const char *, int, int *, int, CssTable *, int *)
<dd> Count database records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCDeleteTable"><b>ODBCDeleteTable</b></a> (SQLHDBC, const char *, CssTable)
<dd> Delete a database table record.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCDeleteTables"><b>ODBCDeleteTables</b></a> (SQLHDBC, const char *, int, CssTable *)
<dd> Delete database table records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCDeleteTablesWhere"><b>ODBCDeleteTablesWhere</b></a> (SQLHDBC, const char *, int, int *, int, CssTable *)
<dd> Delete database table records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCDeleteTableWhere"><b>ODBCDeleteTableWhere</b></a> (SQLHDBC, const char *, int, int *, CssTable)
<dd> Delete a database table record.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCGetWhereMembers"><b>ODBCGetWhereMembers</b></a> (CssTable, int *)
<dd> Return the members indices of a CssTable ordered for a where clause.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCUpdateTable"><b>ODBCUpdateTable</b></a> (SQLHDBC, const char *, CssTable, CssTable)
<dd> Update one database record.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCUpdateTables"><b>ODBCUpdateTables</b></a> (SQLHDBC, const char *, int, CssTable *, CssTable *)
<dd> Update num database records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCUpdateTablesWhere"><b>ODBCUpdateTablesWhere</b></a> (SQLHDBC, const char *, int, int *, int, int *, int, CssTable *, CssTable *)
<dd> Update num database records.
 <dt> <img src="red_ball_small.gif" width=6 height=6 alt=" o ">
      <a href="#ODBCUpdateTableWhere"><b>ODBCUpdateTableWhere</b></a> (SQLHDBC, const char *, int, int *, int, int *, CssTable, CssTable)
<dd> Update one database record.
</dl>
<h2>
Public Functions
</h2>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCCountTable"><b>ODBCCountTable</b></a>
<pre>
 int ODBCCountTable(SQLHDBC hdbc,
                    const char *tableName,
                    int numWhere,
                    int *whereIndices,
                    CssTable table,
                    int *count)
</pre>
<dl>
<dd>  Count database records. Count the number of records that partially match the
  input record. The table members to compare are specified by the whereIndices.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the where members in the CssTable  structure.

<dd> table - The CssTable object whose members will be used the  where clause.

<dd> count - The number of records that match.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCCountTables"><b>ODBCCountTables</b></a>
<pre>
 int ODBCCountTables(SQLHDBC hdbc,
                     const char *tableName,
                     int numWhere,
                     int *whereIndices,
                     int num,
                     CssTable *tables,
                     int *count)
</pre>
<dl>
<dd>  Count database records. Count the number of records that partially match the
  input records. The table members to compare are specified by the
  whereIndices.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the where members in the CssTable  structure.

<dd> num - The number of different records to use in the where clause.

<dd> tables - The CssTable objects whose members will be used the  where clause.

<dd> count - The number of records that match.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCDeleteTable"><b>ODBCDeleteTable</b></a>
<pre>
 int ODBCDeleteTable(SQLHDBC hdbc,
                     const char *tableName,
                     CssTable table)
</pre>
<dl>
<dd>  Delete a database table record. All of the members (except type CSS_LDDATE)
  of input CssTable are used in the where clause.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> table - The CssTable object whose members will be used the  where clause.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCDeleteTables"><b>ODBCDeleteTables</b></a>
<pre>
 int ODBCDeleteTables(SQLHDBC hdbc,
                      const char *tableName,
                      int num,
                      CssTable *tables)
</pre>
<dl>
<dd>  Delete database table records. All of the members (except type CSS_LDDATE)
  of input CssTables are used in the where clause.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> num - The number of table records to delete.

<dd> tables - The CssTable objects whose members will be used the  where clause.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCDeleteTablesWhere"><b>ODBCDeleteTablesWhere</b></a>
<pre>
 int ODBCDeleteTablesWhere(SQLHDBC hdbc,
                           const char *tableName,
                           int numWhere,
                           int *whereIndices,
                           int num,
                           CssTable *tables)
</pre>
<dl>
<dd>  Delete database table records. The members that will be used in the
  where clause are specified by the whereIndices array.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the members to use in the where clause.

<dd> num - The number of table records to delete.

<dd> tables - The CssTable objects whose members will be used the  where clause.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCDeleteTableWhere"><b>ODBCDeleteTableWhere</b></a>
<pre>
 int ODBCDeleteTableWhere(SQLHDBC hdbc,
                          const char *tableName,
                          int numWhere,
                          int *whereIndices,
                          CssTable table)
</pre>
<dl>
<dd>  Delete a database table record. The members that will be used in the
  where clause are specified by the whereIndices array.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the members to use in the where clause.

<dd> table - The CssTable object whose members will be used the  where clause.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCGetWhereMembers"><b>ODBCGetWhereMembers</b></a>
<pre>
 int ODBCGetWhereMembers(CssTable css,
                         int *where)
</pre>
<dl>
<dd>   Return the members indices of a CssTable ordered for a where clause.
   Id members (arid,orid, etc) are place first followed by all other integer
   members, all string members and then all float and double members.
   Members of type CSS_LDDATE are not included.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> css - A CssTable object.

<dd> where - The ordered member indices.

<dt> <b>Returns:</b>
<dd> the number of indices returned in where[].

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCUpdateTable"><b>ODBCUpdateTable</b></a>
<pre>
 int ODBCUpdateTable(SQLHDBC hdbc,
                     const char *tableName,
                     CssTable old_table,
                     CssTable new_table)
</pre>
<dl>
<dd>  Update one database record. Update each member (column) of old_table
  that differs from the corresponding member in new_table. Columns of type
  CSS_LDDATE are automatically updated using name=CURRENT_TIMESTAMP. All of the
  members of old_table (except CSS_LDDATE members) are used in the where clause.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> old_table - The original CssTable object whose elements will be used  in the where clause.

<dd> new_table - The CssTable object with new values.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCUpdateTables"><b>ODBCUpdateTables</b></a>
<pre>
 int ODBCUpdateTables(SQLHDBC hdbc,
                      const char *tableName,
                      int num,
                      CssTable *old_tables,
                      CssTable *new_tables)
</pre>
<dl>
<dd>  Update num database records. Update each member (column) of each record in
  new_tables that differs from the corresponding member and record in
  old_tables. Columns of type CSS_LDDATE are automatically updated using
  name=CURRENT_TIMESTAMP. All of the members of the old_tables records
  (except CSS_LDDATE members) are used in the where clause.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> num - The number of records to update.

<dd> old_tables - The original CssTable objects whose elements will be used  in the where clause.

<dd> new_tables - The CssTable objects with new values.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCUpdateTablesWhere"><b>ODBCUpdateTablesWhere</b></a>
<pre>
 int ODBCUpdateTablesWhere(SQLHDBC hdbc,
                           const char *tableName,
                           int numMembers,
                           int *memberIndices,
                           int numWhere,
                           int *whereIndices,
                           int num,
                           CssTable *old_tables,
                           CssTable *new_tables)
</pre>
<dl>
<dd>  Update num database records. The members to update are specified by
  the memberIndices array. (Columns of type CSS_LDDATE are automatically
  updated using name=CURRENT_TIMESTAMP.) The members to use in the where
  clause are specified by the whereIndices array. The updated values are
  taken from the new_tables objects and the where values are taken from the
  old_tables objects.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> numMembers - The number of members of each record to update.

<dd> memberIndices - The indices of the members in the CssTable structure.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the where members in the CssTable  structure.

<dd> num - The number of records to update.

<dd> old_tables - The original CssTable objects whose members will be used  in the where clause.

<dd> new_tables - The CssTable objects with new values.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<img src="red_ball.gif" width=12 height=12 alt= " o ">
<a name="ODBCUpdateTableWhere"><b>ODBCUpdateTableWhere</b></a>
<pre>
 int ODBCUpdateTableWhere(SQLHDBC hdbc,
                          const char *tableName,
                          int numMembers,
                          int *memberIndices,
                          int numWhere,
                          int *whereIndices,
                          CssTable old_table,
                          CssTable new_table)
</pre>
<dl>
<dd>  Update one database record. The members to update are specified by
  the memberIndices array. (Columns of type CSS_LDDATE are automatically
  updated using name=CURRENT_TIMESTAMP.) The members to use in the where
  clause are specified by the whereIndices array. The updated values are
  taken from the new_table object and the where values are taken from the
  old_table object.

<p>
<dd><dl>
<dt> <b>Parameters:</b>
<dd> hdbc - The ODBC connection handle.

<dd> tableName - The database table name, with an account prefix if needed.

<dd> numMembers - The number of members of the new_table object to update.

<dd> memberIndices - The indices of the members in the CssTable structure.

<dd> numWhere - The number of members to use in the where clause.

<dd> whereIndices - The indices of the where members in the CssTable  structure.

<dd> old_table - The original CssTable object whose members will be used  in the where clause.

<dd> new_table - The CssTable object with new values.

<dt> <b>Returns:</b>
<dd> 0 for success,  -1 for failure.  Retrieve the error number and the  error message with ODBCErrno() and ODBCErrMsg().

</dl></dd>
</dl>
<!Begin-Footer><hr>
<pre>
<a href="directories.html">All directories</a>  <a href="libsrc_libgODBC.html">This Directory</a>  <a href="libsrc_libgODBC_ODBCRequestIds.c.html#_top_">Previous</a>  <a href="libsrc_libgODBC_ODBCUtil.c.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
